---
import { getCollection } from "astro:content";
import Layout from "@/layouts/Layout.astro";
import formatDate from "@/utils/formatDate";

const gallery = await getCollection("gallery");
const sortedPosts = gallery.sort((a, b) => 
  new Date(b.data.publishedAt).getTime() - new Date(a.data.publishedAt).getTime()
);
---

<Layout title="Mint Sorai - All Posts">
  <main class="flex flex-col gap-20 px-10">
    <article>
      <h1 class="text-2xl text-primary">Gallery</h1>
      <span>
        Just some of my art works!
      </span>
    </article>

      <div class="flex gap-4">
        {
      sortedPosts.map(async (post) => {
        const { Content } = await post.render(); 
        return (
          <a
            class="group flex flex-col gap-2 py-4 transition-all hover:text-primary"
            href={`/gallery/${post.slug}`}
          >

            <div class="image-container prose prose-sm content">
              <Content />
            </div>

              <div class=" ">
              {/* <h2 class="text-lg font-semibold">{post.data.title}</h2> */}
              <div class="block text-center">
                {formatDate(post.data.publishedAt)}
              </div>
            </div>
            
          </a>
        );
      })
    }
      </div>
  </main>
</Layout>

<style>


  .image-container :global(p) {
    margin: 0;
    @apply w-[150px] h-[150px] flex justify-center items-center;
  }

  /* 然後，對 <img> 標籤應用我們需要的樣式 
  */
  .image-container :global(img) {
    max-width: 100%;
    max-height: 100%;
    object-fit: cover;
    margin: 0;
  }
</style>

<script>
  const imageContainers = document.querySelectorAll(".image-container");

  imageContainers.forEach((container) => {
    if (container) {
      const img = container.querySelector("img");
      if (img) {
        container.addEventListener("mouseenter", () => {
          img.style.transform = "scale(1.3)";
          img.style.transition = "transform 0.3s ease-in-out";
        });

        container.addEventListener("mouseleave", () => {
          img.style.transform = "scale(1)";
          img.style.transition = "transform 0.3s ease-in-out";
        });
      }
    }
  });
</script>
